export PROMPT='%n@%m:%1~ %% '
if [ ! -z "$SSH_CLIENT" ]; then
	export PROMPT='%F{green}%n@%m%f:%1~ %% '
fi

CACHE_DIR=$HOME/.cache
if [ -d "$HOME/Library/Caches" ]; then
	CACHE_DIR=$HOME/Library/Caches
fi

STATE_DIR=$HOME/.local/state
mkdir -p $STATE_DIR

export CARGO_HOME=$"$HOME/.cargo"
export ETCDCTL_API=3
export GOPATH="$HOME/.go"
export GOCACHE="$CACHE_DIR/go/build"
export GOMODCACHE="$CACHE_DIR/go/mod"
export GOSUMDB=sum.golang.google.cn
export HOMEBREW_NO_AUTO_UPDATE=1
export HOMEBREW_NO_INSTALL_CLEANUP=1
export HOMEBREW_CASK_OPTS="--no-quarantine"
export NIXPKGS_ALLOW_INSECURE=1
export NIXPKGS_ALLOW_UNFREE=1

export REDISCLI_HISTFILE="$STATE_DIR/redis/rediscli_history"
mkdir -p `dirname $REDISCLI_HISTFILE`

# Homebrew
if [ -f /usr/local/bin/brew ]; then
	eval $(/usr/local/bin/brew shellenv)
fi

# Nix
if [ -e ~/.nix-profile/etc/profile.d/nix.sh ]; then
	source ~/.nix-profile/etc/profile.d/nix.sh
fi

BIN_DIRS=(
	$CARGO_HOME/bin
	$GOPATH/bin
)
for BIN_DIR in ${BIN_DIRS[@]}; do
	if [ -d "$BIN_DIR" ]; then
		export PATH="$BIN_DIR:$PATH"
	fi
done

# Aliases
alias ll='ls -alv'
alias la='ls -A'
alias l='ls -CF'
alias rustup='HTTP_PROXY=http://127.0.0.1:7890 HTTPS_PROXY=http://127.0.0.1:7890 rustup'
alias pj="pbpaste | gojq ."
alias typora="open -a typora"

if command -v brew 1>/dev/null 2>&1; then
	alias brew='HTTP_PROXY=http://127.0.0.1:7890 HTTPS_PROXY=http://127.0.0.1:7890 brew'
	alias brew-noproxy="${HOMEBREW_PREFIX}/bin/brew"
fi

# Functions
function goworkspace {
    ssh -t workspace '/home/aaron/.nix-profile/bin/tmux -CC new -A -s workspace'
}

function proxyon() {
	export HTTP_PROXY=http://127.0.0.1:7890
	export HTTPS_PROXY=http://127.0.0.1:7890
}

# Completions
if [ -d ~/.nix-profile/share/zsh/site-functions ]; then
    FPATH=~/.nix-profile/share/zsh/site-functions:$FPATH
fi

# For Debian derivations
if [ -d /usr/share/zsh/vendor-completions ]; then
    FPATH=/usr/share/zsh/vendor-completions:/usr/share/zsh/site-functions:$FPATH
fi

autoload -Uz compinit && compinit

# Kafkactl
if command -v kafkactl 1>/dev/null 2>&1; then
	source <(kafkactl completion zsh) && compdef _kafkactl kafkactl
fi

# Zoxide
if command -v zoxide 1>/dev/null 2>&1; then
	eval "$(zoxide init zsh)"
fi

# zsh-autosuggestions
if [ -f ~/.nix-profile/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]; then
	source ~/.nix-profile/share/zsh-autosuggestions/zsh-autosuggestions.zsh
elif [ -f "$HOMEBREW_PREFIX/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ]; then
	source $HOMEBREW_PREFIX/share/zsh-autosuggestions/zsh-autosuggestions.zsh
fi

# zsh-syntax-highlighting
if [ -f ~/.nix-profile/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]; then
    source ~/.nix-profile/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
elif [ -f "$HOMEBREW_PREFIX/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]; then
    source $HOMEBREW_PREFIX/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
fi

