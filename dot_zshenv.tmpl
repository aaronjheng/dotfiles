# Zsh options
unsetopt GLOBAL_RCS
setopt INC_APPEND_HISTORY

# Base Directories
CONFIG_DIR=${HOME}/.config
{{ if eq .chezmoi.os "darwin" -}}
CACHE_DIR="${HOME}/Library/Caches"
STATE_DIR="${HOME}/Library/Application Support"
{{- else -}}
CACHE_DIR="${HOME}/.cache"
STATE_DIR="${HOME}/.local/state"
{{- end }}

NIX_PROFILE_DIR="${HOME}/.local/state/nix/profile"

export CARGO_HOME="${HOME}/.cargo"
export GOPATH="${HOME}/.go"
export GOCACHE="${CACHE_DIR}/go/build"
export GOMODCACHE="${CACHE_DIR}/go/mod"
export GOPROXY="https://goproxy.cn,direct"
export HOMEBREW_NO_AUTO_UPDATE=1
export HOMEBREW_NO_INSTALL_CLEANUP=1
export HOMEBREW_CASK_OPTS="--no-quarantine"
export HOMEBREW_GITHUB_API_TOKEN={{ .github.token }}
export HOMEBREW_UPGRADE_GREEDY=1
export NPM_CONFIG_USERCONFIG="${CONFIG_DIR}/npm/npmrc"
export REDISCLI_HISTFILE="${STATE_DIR}/redis/history"
export WGETRC="${CONFIG_DIR}/wgetrc"
export VSCE_PAT={{ .vsce.token }}
export GITHUB_TOKEN={{ .github.token }}
export ETCDCTL_API=3
export NIXPKGS_ALLOW_INSECURE=1
export NIXPKGS_ALLOW_UNFREE=1
export PYTHONSTARTUP="${CONFIG_DIR}/python/pythonrc"


# Paths
typeset -U PATH path

BIN_DIRS=(
  "${CARGO_HOME}/bin"
  "${GOPATH}/bin"
)
for BIN_DIR in ${BIN_DIRS[@]}; do
  if [ -d "${BIN_DIR}" ]; then
    PATH="${BIN_DIR}:${PATH}"
  fi
done

{{ if eq .chezmoi.os "linux" -}}
# Nix
if [ -e "${NIX_PROFILE_DIR}/etc/profile.d/nix.sh" ]; then
  source "${NIX_PROFILE_DIR}/etc/profile.d/nix.sh"
fi

{{ end -}}

{{ if eq .chezmoi.os "darwin" -}}
# Homebrew
{{ if eq .chezmoi.arch "arm64" -}}
if [ -f /opt/homebrew/bin/brew ]; then
  eval $(/opt/homebrew/bin/brew shellenv)
fi
{{ else -}}
if [ -f /usr/local/bin/brew ]; then
  eval $(/usr/local/bin/brew shellenv)
fi
{{ end }}
# Nix
if [ -e '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh' ]; then
  source '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh'
fi
{{ end -}}
