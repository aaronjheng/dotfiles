# Prompt
export PROMPT='%n@%m:%1~ %% '
if [ ! -z "$SSH_CLIENT" ]; then
  export PROMPT='%F{green}%n@%m%f:%1~ %% '
fi

# Base Directories
{{ if eq .chezmoi.os "darwin" -}}
CACHE_DIR="${HOME}/Library/Caches"
STATE_DIR="${HOME}/Library/Application Support"
{{- else -}}
CACHE_DIR="${HOME}/.cache"
STATE_DIR="${HOME}/.local/state"
{{- end }}

export CARGO_HOME="${HOME}/.cargo"
export ETCDCTL_API=3
export GITHUB_TOKEN={{ .github.token }}
export GOPATH="${HOME}/.go"
export GOCACHE="$CACHE_DIR/go/build"
export GOMODCACHE="$CACHE_DIR/go/mod"
export GOPROXY=goproxy.cn,direct
export GOSUMDB=sum.golang.google.cn
export HOMEBREW_NO_INSTALL_CLEANUP=1
export HOMEBREW_CASK_OPTS="--no-quarantine"
export HOMEBREW_GITHUB_API_TOKEN={{ .github.token }}
export NIXPKGS_ALLOW_INSECURE=1
export NIXPKGS_ALLOW_UNFREE=1
export NPM_CONFIG_USERCONFIG="${HOME}/.config/npm/npmrc"
export REDISCLI_HISTFILE="${STATE_DIR}/redis/history"
export TRUNK_MIXPANEL=off
export VSCE_PAT={{ .vsce.token }}

# FPATH
FUNC_DIRS=(
  ${HOME}/.local/state/nix/profile/share/zsh/site-functions
  /usr/share/zsh/site-functions
  /usr/share/zsh/vendor-completions
  /opt/homebrew/share/zsh/site-functions
)
for FUNC_DIR in ${FUNC_DIRS[@]}; do
  FPATH="$FUNC_DIR:$FPATH"
done

# Completions
autoload -Uz compinit && compinit -d "$CACHE_DIR/zsh/zcompdump-$ZSH_VERSION"
zstyle ':completion:*' cache-path "$CACHE_DIR/zsh/zcompcache"

{{ if eq .chezmoi.os "linux" -}}
# Nix
if [ -e ${HOME}/.local/state/nix/profile/etc/profile.d/nix.sh ]; then
  source ${HOME}/.local/state/nix/profile/etc/profile.d/nix.sh
fi
{{ end -}}

{{ if eq .chezmoi.os "darwin" -}}
# Homebrew
{{ if eq .chezmoi.arch "arm64" -}}
if [ -f /opt/homebrew/bin/brew ]; then
  eval $(/opt/homebrew/bin/brew shellenv)
fi
{{ else -}}
if [ -f /usr/local/bin/brew ]; then
  eval $(/usr/local/bin/brew shellenv)
fi
{{ end -}}
{{ end -}}
